# LP自動デプロイ設定 完了報告・記録

このドキュメントは、GitHub Actions を使用したエックスサーバーへの自動デプロイ環境の構築プロセスと、その後の不具合対策について記録したものです。

## 1. 確定したデプロイ情報（本物の場所）

今回、試行錯誤の結果、実際にLPが表示されている「正解の場所」を以下の通り特定・固定しました。

- **エックスサーバー上の絶対パス**: `fukuterrace.jp/public_html/lp.fukuterrace.jp/`
- **デプロイ方法**: GitHub `main` ブランチへのプッシュで自動転送（GitHub Actions）

## 2. 発生したトラブルと対策の変更点

### ① 転送先の取り違え（1回目・2回目）
- **事象**: 一見正解に見える `/lp.fukuterrace.jp/public_html/` に送っていたが、実際には表示に反映されなかった。
- **原因**: エックスサーバーのサブドメイン構成が複数存在し、誰も見ていない「空のフォルダ」を更新していた。
- **対策**: **「実際にWebP画像が表示されること」を確認できたパスのみを `deploy.yml` に記述し、固定。** 推測による変更を一切禁止した。

### ② Internal Server Error (500) の発生
- **事象**: 自動デプロイ後にサイトが真っ白（500エラー）になった。
- **原因**: サーバー側にあった重要な設定ファイル（`.htaccess`）を、GitHub側から空の（または不適切な）ファイルで上書きしてしまったため。
- **対策**: **`deploy.yml` の `exclude`（除外）リストに `.htaccess` を追加。** 今後は GitHub から何をプッシュしても、サーバー側の設定ファイルを絶対に上書き・破壊できない物理的なガードレールを設置した。

### ③ キャッシュによる反映遅延
- **事象**: ファイルは届いているのに、ブラウザ上が古いまま変わらない。
- **原因**: ブラウザおよびサーバーのキャッシュが強力だった。
- **対策**: **HTML内のCSS/JSファイル名に `?v=20` のようなバージョン番号を付与。** コード変更のたびにこの番号を更新することで、ブラウザに「新しいファイル」であることを強制認識させる運用を徹底。

## 3. 今後の運用ルール

1. **GitHubへプッシュするだけ**: 修正したファイルを GitHub に上げれば、約1分で「本物の場所」が自動更新されます。
2. **ZIP・FTP不要**: 手動でのZIP作成やファイルマネージャー操作は一切不要です。
3. **安全性の担保**: 大事なサーバー設定（.htaccess）はプログラムによって保護されているため、自動更新によってサイトが壊れることはありません。

---
2026年1月7日 記録作成

